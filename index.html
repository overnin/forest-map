<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2E7D32">
    <title>Forest Map - GPS Tracker</title>
    
    <!-- Mapbox GL JS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js"></script>
    
    <!-- App Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/points.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Map Container -->
    <div id="map"></div>
    
    <!-- Control Panel -->
    <div class="control-panel">
        <button id="locate-btn" class="control-btn" title="Center on my location">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 2v4m0 12v4m10-10h-4M6 12H2"></path>
            </svg>
        </button>
        <button id="parcels-btn" class="control-btn active" title="Toggle forest parcels">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
            </svg>
        </button>
        <button id="layer-btn" class="control-btn" title="Toggle map layers">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2L2 7v10l10 5 10-5V7l-10-5z"></path>
                <path d="M12 22V12"></path>
                <path d="M22 7l-10 5L2 7"></path>
            </svg>
        </button>
        <button id="fullscreen-btn" class="control-btn" title="Toggle fullscreen">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
        </button>
        <!-- Mark Point Button -->
        <button id="mark-btn" class="control-btn" data-i18n-title="markPoint">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 2l7 7-7 7-7-7z"></path>
            </svg>
            <span class="type-indicator"></span>
        </button>
        <!-- Filter Button -->
        <button id="filter-btn" class="control-btn" data-i18n-title="pointFilters">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"></path>
            </svg>
        </button>
        <!-- Share Button -->
        <button id="share-btn" class="control-btn" data-i18n-title="sharePoints">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                <polyline points="16,6 12,2 8,6"></polyline>
                <line x1="12" y1="2" x2="12" y2="15"></line>
            </svg>
        </button>
        <!-- Clear All Points Button -->
        <button id="clear-all-btn" class="control-btn danger" data-i18n-title="clearAllPoints">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        </button>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item">
            <span class="status-label">GPS:</span>
            <span id="gps-status" class="status-value">Initializing...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Accuracy:</span>
            <span id="accuracy-status" class="status-value">--</span>
        </div>
        <div class="status-item">
            <span class="status-label">Coordinates:</span>
            <span id="coords-status" class="status-value">--, --</span>
        </div>
        <div class="status-item">
            <span class="status-label" data-i18n="points">Points:</span>
            <span id="points-summary" class="status-value">
                <span class="type-stat exploitation">E:0</span>
                <span class="type-stat clearing">C:0</span>
                <span class="type-stat boundary">B:0</span>
            </span>
        </div>
        <div class="status-item version-info">
            <span class="status-label">v1.6</span>
        </div>
    </div>
    
    <!-- Layer Selector (Hidden by default) -->
    <div id="layer-selector" class="layer-selector hidden">
        <h3>Map Layers</h3>
        <p style="font-size: 12px; color: #666; margin: 8px 0;">Note: When parcels are visible, the custom forest style is used</p>
        <label class="layer-option">
            <input type="radio" name="map-style" value="streets">
            <span>Streets</span>
        </label>
        <label class="layer-option">
            <input type="radio" name="map-style" value="satellite">
            <span>Satellite</span>
        </label>
        <label class="layer-option">
            <input type="radio" name="map-style" value="terrain">
            <span>Terrain</span>
        </label>
        <label class="layer-option">
            <input type="radio" name="map-style" value="hybrid">
            <span>Hybrid</span>
        </label>
        <label class="layer-option">
            <input type="radio" name="map-style" value="custom" checked>
            <span>Forest Style (with parcels)</span>
        </label>
    </div>
    
    <!-- Type Selector Panel (Hidden by default) -->
    <div id="type-selector" class="type-selector-panel hidden">
        <div class="type-selector-header" data-i18n="selectPointType">Select Point Type:</div>
        <div class="type-buttons">
            <button class="type-btn" data-type="exploitation">
                <span class="type-icon">üí∞</span>
                <span class="type-label" data-i18n="exploitation">Exploitation</span>
                <span class="type-count">0</span>
            </button>
            <button class="type-btn" data-type="clearing">
                <span class="type-icon">üíÄ</span>
                <span class="type-label" data-i18n="clearing">Clearing</span>
                <span class="type-count">0</span>
            </button>
            <button class="type-btn" data-type="boundary">
                <span class="type-icon">üìç</span>
                <span class="type-label" data-i18n="boundary">Boundary</span>
                <span class="type-count">0</span>
            </button>
        </div>
    </div>
    
    <!-- Point Filter Selector (Hidden by default) -->
    <div id="point-filter-selector" class="point-filter-selector hidden">
        <h3 data-i18n="pointFilters">Point Filters</h3>
        <div class="filter-item">
            <input type="checkbox" id="show-exploitation" checked>
            <label for="show-exploitation">
                <span class="marker-dot exploitation"></span>
                <span data-i18n="exploitation">Exploitation</span>
                <span class="filter-count" id="count-exploitation">0</span>
            </label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="show-clearing" checked>
            <label for="show-clearing">
                <span class="marker-dot clearing"></span>
                <span data-i18n="clearing">Clearing</span>
                <span class="filter-count" id="count-clearing">0</span>
            </label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="show-boundary" checked>
            <label for="show-boundary">
                <span class="marker-dot boundary"></span>
                <span data-i18n="boundary">Boundary</span>
                <span class="filter-count" id="count-boundary">0</span>
            </label>
        </div>
    </div>
    
    <!-- Permission Request Modal -->
    <div id="permission-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Location Access Required</h2>
            <p>This app needs access to your location to show your position on the map.</p>
            <button id="request-permission" class="primary-btn">Enable Location</button>
            <div id="debug-info" style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px; font-size: 12px; color: #666; display: none;">
                <strong>Debug Info:</strong>
                <div id="debug-content"></div>
            </div>
            <button onclick="(function(){var d=document.getElementById('debug-info');if(d){d.style.display=d.style.display==='none'?'block':'none';if(d.style.display==='block')LocationTracker.showDebugInfo();}})();" style="margin-top: 10px; font-size: 12px; background: #eee; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Show Debug Info</button>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/i18n.js"></script>
    <script src="js/user-manager.js"></script>
    <script src="js/points.js"></script>
    <script src="js/export.js"></script>
    <script src="js/map.js"></script>
    <script src="js/location.js"></script>
    <script src="js/app.js"></script>
</body>
</html>